console.log("preloading images");const preloaderImages=["goldenfreddy.jpg","ui/bar.png","ui/map.png","ui/noise.png","rooms/placeholder.jpg","rooms/office.png","power/1.png","power/2.png","power/3.png","power/4.png","door/closed.png","door/open.png","door/light.png","jumpscares/0.gif","jumpscares/1.gif","jumpscares/2.png","jumpscares/3.gif"];var preloaderImageElement=new Image;preloaderImages.forEach(e=>{preloaderImageElement.src="/assets/"+e}),console.log("preloading audio");const preloaderAudios=["ambient/1.ogg","ambient/2.ogg","bgm.mp3","camera-switch.ogg","door-close-l.ogg","door-close-r.ogg","door-open-l.ogg","door-open-r.ogg","end.ogg","knock.ogg","light-l.ogg","light-r.ogg","movement.ogg","jumpscare/2.ogg","jumpscare/3.ogg","stalker.mp3","static.ogg"];var preloaderAudioElement=new Audio;preloaderAudios.forEach(e=>{preloaderAudioElement.src="/assets/audio/"+e});var nightData={rooms:{office:{current:[],startpositions:[],denied:[],neighbours:["office"],hasCamera:!1},rhall:{current:[],startpositions:[],denied:[2],neighbours:["rhall","office","pr1"],hasCamera:!0},stage:{current:[],startpositions:[0,1,2],denied:[3],neighbours:["stage","dining"],hasCamera:!0},pr2:{current:[],startpositions:[],denied:[],neighbours:["pr2","dining"],hasCamera:!0},pirate:{current:[],startpositions:[3],denied:[0,1,2],neighbours:["pirate","dining"],hasCamera:!0},pr1:{current:[],startpositions:[],denied:[2],neighbours:["pr1","dining","rhall"],hasCamera:!0},entrance:{current:[],startpositions:[],denied:[2],neighbours:["entrance","dining"],hasCamera:!0},saferoom:{current:[],startpositions:[],denied:[],neighbours:["saferoom","mainhall"],hasCamera:!0},mainhall:{current:[],startpositions:[],denied:[],neighbours:["mainhall","w","m","saferoom","lhall"],hasCamera:!0},lhall:{current:[],startpositions:[],denied:[0,1],neighbours:["lhall","office","mainhall"],hasCamera:!0},dining2:{current:[],startpositions:[],denied:[],neighbours:["dining2","dining","entrance","pr2","pirate"],hasCamera:!0},dining:{current:[],startpositions:[],denied:[],neighbours:["dining","dining2","mainhall","stage","pr1","pr2"],hasCamera:!0},w:{current:[],startpositions:[],denied:[0,1,2],neighbours:["w","mainhall"],hasCamera:!1},m:{current:[],startpositions:[],denied:[3],neighbours:["m","mainhall"],hasCamera:!1}},ai:[]};function getCookie(e){let t=e+"=",s=decodeURIComponent(document.cookie).split(";");for(let e=0;e<s.length;e++){let o=s[e];for(;" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}const currentNight=getCookie("save");switch(currentNight){case 1:case 2:case 3:nightData.ai=[2,2,2,2];break;default:nightData.ai=[20,20,20,20]}var ambientAudioVolume=1,currentAudios=[];function playAudio(e,t="ambient"){const s=new Audio(e);"ambient"&&(s.volume=ambientAudioVolume),currentAudios.push(s),s.addEventListener("ended",()=>{const e=currentAudios.indexOf(s);currentAudios.splice(e,1)}),s.play()}function changeVolume(e,t="ambient"){ambientAudioVolume=e,currentAudios.forEach(t=>{t.volume=e})}Object.entries(nightData.rooms).forEach(e=>{e[1].startpositions.forEach(t=>{e[1].current.push(t)})});var currentPositionsHistory=[];function checkForAmbient(){let e=[];Object.entries(nightData.rooms).forEach(t=>{t[1].current.forEach(s=>{e[s]=t[0]})}),currentPositionsHistory.length>5&&currentPositionsHistory.shift(),currentPositionsHistory.push(e);var t="[20,20,20,20]"==JSON.stringify(nightData.ai)?3:5,s=currentPositionsHistory;if(s.length>t)for(let e=0;e<s.length-t;e++)s.shift();if(s.length==t){var o=[[],[],[]];s.forEach(e=>{var t=0;e.forEach(e=>{3!=t&&(o[t].push(e),t+=1)})}),o.some(e=>e.every(t=>t===e[0]))&&playAudio("/assets/audio/ambient/2.ogg")}e=e.filter(e=>["m","w"].includes(e)),e.length>=2&&playAudio("/assets/audio/ambient/1.ogg")}var dead=!1,won=!1;function mvTick(){if(dead||won)return;console.log("mv");let e=[],t=[];Object.entries(nightData.rooms).forEach(t=>{t[1].current.forEach(s=>{e[s]=t[0]})}),Object.entries(nightData.rooms).forEach(e=>{e[1].startpositions.forEach(s=>{t[s]=e[0]})});let s=0;nightData.ai.forEach(o=>{if(3===s)if(Math.max(lastCameraOpen,lastCameraClose)+foxyStun>=Date.now())return;if(Math.floor(20*Math.random())<o){const o=nightData.rooms[e[s]];var a=[];Array.from(o.neighbours).forEach(e=>{!Array.from(nightData.rooms[e].denied).includes(s)&&a.push(e)});let n=a[Math.floor(Math.random()*a.length)],r=o.current;const i=r.indexOf(s);if(n!=o.neighbours[0]&&playAudio("/assets/audio/movement.ogg"),"office"==n)switch(o.neighbours[0]){case"lhall":if(doors.l){playAudio("/assets/audio/knock.ogg");const e=2*currentNight+hour;power-=e,setTimeout(()=>{power-=e,setTimeout(()=>{power-=e,setTimeout(()=>{power-=e},150)},150)},150),n=t[s]}else{dead=!0;const e=document.getElementById("jumpscare");switch(e.classList.remove("no"),s.toString()){case"0":e.src="/assets/jumpscares/0.gif",death();break;case"1":e.src="/assets/jumpscares/1.gif",death();break;case"2":e.src="/assets/jumpscares/2.png",playAudio("/assets/audio/jumpscare/2.ogg"),setTimeout(()=>{death()},1e4);break;case"3":e.src="/assets/jumpscares/3.gif",playAudio("/assets/audio/jumpscare/3.mp3"),death()}}break;case"rhall":if(doors.r){playAudio("/assets/audio/knock.ogg");const e=2*currentNight+hour;power-=e,setTimeout(()=>{power-=e,setTimeout(()=>{power-=e,setTimeout(()=>{power-=e},150)},150)},150),n=t[s]}else dead=!0,death()}r.splice(i,1),nightData.rooms[n].current.push(s)}s+=1}),switchCamera(currentCamera);const o=document.getElementById("nightdatadbug");o.innerHTML="",Object.entries(nightData.rooms).forEach(e=>{o.innerHTML+="<br>"+JSON.stringify(e[0])+JSON.stringify(e[1])});document.getElementById("ticktimedbug").innerHTML=4500-200*hour,checkForAmbient(),setTimeout(()=>{mvTick()},4500-200*hour)}const instantMvTick=!1;function lighttick(){if(won)return;const e=document.getElementById("ldoor").querySelector("img"),t=document.getElementById("rdoor").querySelector("img"),s="/assets/door/closed.png",o="/assets/door/open.png";if(lights.l){var a=doors.l?s:"/assets/door/light.png";0!=nightData.rooms.lhall.current.length&&(a=`/assets/door/${nightData.rooms.lhall.current[0]}${doors.l?1:0}.png`),e.src=a}else e.src=doors.l?s:o;if(lights.r){a=doors.r?s:"/assets/door/light.png";0!=nightData.rooms.rhall.current.length&&(a=`/assets/door/${nightData.rooms.rhall.current[0]}${doors.r?1:0}.png`),t.src=a}else t.src=doors.r?s:o;setTimeout(()=>{lighttick()},200)}function death(){won||(iscameraon?setTimeout(()=>{document.getElementsByClassName("static")[0].classList.add("hide"),document.getElementsByClassName("camui")[0].style.display="none",document.getElementsByClassName("cam")[0].style.opacity=0,document.getElementsByClassName("cam")[0].style.zIndex=-2,usage-=1,document.getElementsByClassName("deathcounter")[0].classList.remove("notyet"),setTimeout(()=>{window.location.href="/menu"},1e4)},3e3):(document.getElementsByClassName("deathcounter")[0].classList.remove("notyet"),setTimeout(()=>{window.location.href="/menu"},1e4)))}setTimeout(()=>{mvTick()},1e4),setTimeout(()=>{lighttick()},500);var power=1005,usage=1,currentpowercountdown=0;function powerHandler(){if(!won){if(10==currentpowercountdown?(currentpowercountdown=0,power-=usage):currentpowercountdown+=1,power<-1e4)return document.getElementsByClassName("static")[0].classList.remove("hide"),document.getElementById("powerdbug").innerHTML="<img src='/assets/goldenfreddy.jpg'>",document.getElementById("usagedbug").innerHTML="<img src='/assets/goldenfreddy.jpg'>",document.getElementById("powerui").innerHTML="-21312312312",document.getElementById("usageui").innerHTML="-21312312312",setTimeout(()=>{document.getElementById("newspaper").classList.add("animless"),document.getElementById("newspaper").src="/assets/goldenfreddy.jpg"},1700),document.getElementsByClassName("camui")[0].remove(),playAudio("/assets/audio/bgm.mp3"),void setTimeout(()=>{window.location.href="/menu"},21e3);document.getElementById("powerdbug").innerHTML=power,document.getElementById("usagedbug").innerHTML=usage,document.getElementById("powerui").innerHTML=Math.round(power/10);var e=`<img src="/assets/power/${usage}.png" class="usagebar">`;document.getElementById("usageui").innerHTML!=e&&(document.getElementById("usageui").innerHTML=e),setTimeout(()=>{powerHandler()},100)}}powerHandler();var hour=-1;function incrementhour(){hour+=1,document.getElementById("hour").innerHTML=(0==hour?12:hour)+" AM",6==hour&&(new Audio("/assets/audio/end.ogg").play(),won=!0,document.cookie=`save=${parseInt(getCookie("save"))+1};path=/`,document.getElementsByClassName("end")[0].classList.remove("no"),setTimeout(()=>{window.location.href="/menu"},9e3)),setTimeout(()=>{incrementhour()},6e4)}incrementhour();var withTesticularTorsion=!1,wezMiKurwaWylaczTenJebanyKrzykBoJaKurwaSieBoje=!1;function skretJadra(){withTesticularTorsion=!0,document.getElementsByClassName("testicle")[0].classList.remove("no"),wezMiKurwaWylaczTenJebanyKrzykBoJaKurwaSieBoje||(playAudio("/assets/audio/stalker.mp3"),setTimeout(()=>{playAudio("/assets/audio/stalker.mp3"),setTimeout(()=>{playAudio("/assets/audio/stalker.mp3")},2e3)},2e3)),setTimeout(()=>{withTesticularTorsion=!1,document.getElementsByClassName("testicle")[0].classList.add("no")},6e3+1e3*Math.random())}var width=document.getElementsByClassName("gra")[0].offsetWidth,limits={l:7,r:-width/1.12+2},rotation=(limits.l+limits.r)/2,iscameraon=!1,currentCamera=2,movingdir=0;function cammove(){if(!won)if(1!=iscameraon){var e=document.getElementsByClassName("gra")[0].offsetWidth;console.log(e);var t=.0125*e;switch(withTesticularTorsion&&(t/=2),movingdir){case 1:rotation+t>=limits.l||(rotation+=t);break;case 2:rotation-t<limits.r||(rotation-=t)}document.getElementsByClassName("room")[0].style.left=`${rotation}px`,document.getElementById("camrotationdbug").innerHTML=rotation,setTimeout(()=>{cammove()},0)}else setTimeout(()=>{cammove()},0)}cammove();const idsWithPassthrough=["rightmov","leftmov"];idsWithPassthrough.forEach(e=>{const t=document.getElementById(e);t.addEventListener("click",e=>{console.log("passing click"),e.stopImmediatePropagation(),e.preventDefault(),t.parentNode.style.display="none";const s=document.elementFromPoint(e.clientX,e.clientY);console.log(s),t.parentNode.style.display="",s&&s.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0,clientX:e.clientX,clientY:e.clientY}))})}),document.getElementById("leftmov").addEventListener("mouseenter",function(){movingdir=1}),document.getElementById("leftmov").addEventListener("mouseleave",function(){movingdir=0}),document.getElementById("rightmov").addEventListener("mouseenter",function(){movingdir=2}),document.getElementById("rightmov").addEventListener("mouseleave",function(){movingdir=0});let params=new URLSearchParams(document.location.search);const firstgame=null==params.get("f");console.log("firstgame? ",firstgame),firstgame?(setTimeout(()=>{document.getElementsByClassName("static")[0].classList.add("hide")},500),setTimeout(()=>{document.getElementsByClassName("flash")[0].classList.remove("off"),document.getElementsByClassName("nightintro")[0].classList.remove("hide"),setTimeout(()=>{document.getElementsByClassName("flash")[0].classList.add("off")},50)},2e3)):(document.getElementsByClassName("static")[0].classList.add("hide"),document.getElementsByClassName("static")[0].style.display="none",setTimeout(()=>{document.getElementsByClassName("static")[0].style.display="block"},1e3),document.getElementById("newspaper").remove(),document.getElementsByClassName("flash")[0].classList.remove("off"),document.getElementsByClassName("nightintro")[0].classList.remove("hide"),setTimeout(()=>{document.getElementsByClassName("flash")[0].classList.add("off")},50));var skipIntro=!1;function formattedNum(e){return 0==e?"???":1==e?e+"st":2==e?e+"nd":3==e?e+"rd":e+"th"}skipIntro&&(document.getElementById("realgra").style.display=""),setTimeout(()=>{document.getElementsByClassName("flash")[0].classList.remove("off"),document.getElementById("realgra").style.display="",setTimeout(()=>{document.getElementsByClassName("flash")[0].classList.add("off")},100)},6e3),setTimeout(()=>{!function e(){won||(67==Math.round(100*Math.random())&&skretJadra(),setTimeout(()=>{e()},1e3))}()},15e3),document.getElementById("intronightnum").innerHTML=formattedNum(currentNight),document.getElementById("curnightui").innerHTML=currentNight;const doorOpenL=new Audio("/assets/audio/door-open-l.ogg"),doorOpenR=new Audio("/assets/audio/door-open-r.ogg"),doorCloseL=new Audio("/assets/audio/door-close-l.ogg"),doorCloseR=new Audio("/assets/audio/door-close-r.ogg");var doors={l:!1,r:!1};function door(e){if(won)return;const t=document.getElementById("ldoor").querySelector("img"),s=document.getElementById("rdoor").querySelector("img"),o="/assets/door/closed.png",a="/assets/door/open.png";switch(e){case 0:doors.l=!doors.l,t.src=doors.l?o:a,doors.l?(doorCloseL.play(),doorOpenL.pause(),doorOpenL.currentTime=0):(doorOpenL.play(),doorCloseL.pause(),doorCloseL.currentTime=0),doors.l?usage+=1:usage-=1;break;case 1:doors.r=!doors.r,s.src=doors.r?o:a,doors.r?(doorCloseR.play(),doorOpenR.pause(),doorOpenR.currentTime=0):(doorOpenR.play(),doorCloseR.pause(),doorCloseR.currentTime=0),doors.r?usage+=1:usage-=1}document.getElementById("doorsdbug").innerText=`${doors.l}  ${doors.r}`}var lights={l:!1,r:!1};const lightAudioL=new Audio("/assets/audio/light-l.ogg"),lightAudioR=new Audio("/assets/audio/light-r.ogg");function light(e){if(won)return;const t=document.getElementById("ldoor").querySelector("img"),s=document.getElementById("rdoor").querySelector("img");switch(e){case 0:if(lights.l=!lights.l,lights.l?t.classList.add("light"):t.classList.remove("light"),lights.l){lights.r&&(lights.r=!1,usage-=1);var o=doors.l?"/assets/door/closed.png":"/assets/door/light.png";lightAudioL.play(),0!=nightData.rooms.lhall.current.length&&(o=`/assets/door/${nightData.rooms.lhall.current[0]}${doors.l?1:0}.png`),t.src=o}else t.src=`/assets/door/${doors.l?"closed":"open"}.png`,lightAudioL.pause();lights.l?usage+=1:usage-=1;break;case 1:if(lights.r=!lights.r,lights.r?s.classList.add("light"):s.classList.remove("light"),lights.r){lights.l&&(lights.l=!1,usage-=1);o=doors.r?"/assets/door/closed.png":"/assets/door/light.png";lightAudioR.play(),0!=nightData.rooms.rhall.current.length&&(o=`/assets/door/${nightData.rooms.rhall.current[0]}${doors.r?1:0}.png`),s.src=o}else s.src=`/assets/door/${doors.r?"closed":"open"}.png`,lightAudioR.pause();lights.r?usage+=1:usage-=1}document.getElementById("lightdbug").innerText=`${lights.l}  ${lights.r}`}function checklight(e){if(won)return;const t=document.getElementById("ldoor").querySelector("img"),s=document.getElementById("rdoor").querySelector("img");switch(e){case 0:lights.l&&(usage-=1),lights.l=!1,t.classList.remove("light"),lightAudioL.pause(),doors.l?t.src="/assets/door/closed.png":t.src="/assets/door/open.png";break;case 1:lights.r&&(usage-=1),lights.r=!1,s.classList.remove("light"),lightAudioR.pause(),doors.r?s.src="/assets/door/closed.png":s.src="/assets/door/open.png"}document.getElementById("lightdbug").innerText=`${lights.l}  ${lights.r}`}function switchCamera(e){if(!won){var t=new Audio("/assets/audio/camera-switch.ogg");iscameraon||(t.volume=0),t.play(),document.getElementsByClassName("static")[0].classList.add("high"),currentCamera=e,e-=1,document.getElementById("gamemapcurrentcameraname").innerText=e;var s=Object.entries(nightData.rooms).filter(e=>e[1].hasCamera).at(e),o=s[1].current,a=0;o.forEach(e=>{a+=Math.pow(2,e)}),console.log(s[0],"sum",a),document.getElementsByClassName("cam")[0].src=`/assets/rooms/${e}-${a}.jpg`,setTimeout(()=>{document.getElementsByClassName("static")[0].classList.remove("high")},100)}}lightAudioL.loop=!0,lightAudioR.loop=!0;const bar=document.getElementById("cambar");var lastCameraOpen=0,lastCameraClose=0,foxyStun=1e3*(17*Math.random()+.8);bar.addEventListener("mouseenter",function(){won||(document.getElementsByClassName("static")[0].classList.add("notrans"),iscameraon=!iscameraon,console.log("camera",iscameraon),iscameraon?(changeVolume(.1),lastCameraOpen=Date.now(),foxyStun=1e3*(17*Math.random()+.8),document.getElementsByClassName("cameracontrols")[0].style.display="none",document.getElementsByClassName("room")[0].style.display="none",document.getElementsByClassName("static")[0].querySelector("audio").play(),document.getElementsByClassName("static")[0].classList.remove("hide"),document.getElementsByClassName("camui")[0].style.display="inherit",document.getElementsByClassName("cam")[0].style.opacity=1,document.getElementsByClassName("cam")[0].style.zIndex=3,usage+=1):(changeVolume(1),lastCameraClose=Date.now(),foxyStun=1e3*(17*Math.random()+.8),document.getElementsByClassName("cameracontrols")[0].style.display="flex",document.getElementsByClassName("room")[0].style.display="inherit",document.getElementsByClassName("static")[0].querySelector("audio").pause(),document.getElementsByClassName("static")[0].classList.add("hide"),document.getElementsByClassName("camui")[0].style.display="none",document.getElementsByClassName("cam")[0].style.opacity=0,document.getElementsByClassName("cam")[0].style.zIndex=-2,usage-=1),bar.style.opacity=0,document.getElementById("arecamsondbug").innerText=iscameraon?"yes":"no")}),bar.addEventListener("mouseleave",function(){won||setTimeout(()=>{bar.style.opacity=1},250)});